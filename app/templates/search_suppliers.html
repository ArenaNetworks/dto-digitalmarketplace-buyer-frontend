{% extends "_base_page.html" %}

{% block page_title %}Suppliers Search â€“ Marketplace{% endblock %}

{% block body_classes %}catalogue{% endblock %}
{% block main_class %}sidebar-has-controls{% endblock %}

{% block hero %}
{% with
  site_title="Welcome to the Marketplace", 
  tagline="This is the complete catalogue of approved ICT partners. You can scroll through them all or filter by selecting the capabilities you need from the menu below.",
  extra=('<a href="' + url_for('main.roles_and_services') + '">Learn more about what each role means</a>')
  %}
  {% include "_hero.html" %}
  {% endwith %}
  {% endblock %}

  {% block sidebar %}
  {% with
  local_nav_toggle='Menu'
  %}
  <aside class="sidebar" id="nav">
    {% include "sidebar/_filter_capabilities.html" %}
  </aside>
  {% endwith %}
  {% endblock %}

  {% block main_content %}
  {% if num_results %}<p class="number-results"><span>{{ num_results }}</span> suppliers</p>{% endif %}

    <div class="{% if sort_terms %}sort-on{% else %}sort-off{% endif %} sort-by-{{ sort_order }}">
        <span>Sort By:</span>
        {% with page_number=page, sort_alternate=True, link_label=sort_term_name_label, sort_terms=['name']  %}
            {% include '_supplier_pagination_link.html' %}
        {% endwith %}
    </div>

    {% if num_results %}
      <p>Showing {{ results_from }}-{{ results_to }} suppliers of {{ num_results }}
      {% else %}No results found.</p>
    {% endif %}

    <ul class="list-horizontal">
      {% for result in results %}
      <li>
        <article>
          <h2><a href="{{ result.url }}">{{ result.title }}</a></h2>

          {% if result.description %}
          <p>{{ result.description }}</p>
          {% endif %}

          {% if result.roles %}
          <footer class="tags">
           <dl>
             <dt>Service capabilities:</dt>
             {% for role in result.roles|sort() %}
             <dd class="{% if role.label in role_list_from_request %}selected{% endif %}">
                 <a href="?role={{ role.label|replace(' ', '+') }}">{{ role.label }}</a>
             </dd>
             {% endfor %}
           </dl>
         </footer>
         {% endif %}
       </article>
     </li>
     {% endfor %}
   </ul>
   {% if num_results %}
   <div>
    <div>
      page {{ page }} of {{ num_pages }}
    </div>

    <div>
      <ul>
        {% for pg in pages %}
        <li class="{% if pg == page %}current{% endif %}">
          {% if pg != '...' %}
          {% with page_number=pg, sort_alternate=False, link_label=pg, sort_terms=sort_terms  %}
                {% include '_supplier_pagination_link.html' %}
            {% endwith %}
          {% else %}
          <span>{{ pg }}</span>
          {% endif %}
        </li>
        {% endfor %}
      </ul>
    </div>
  </div>
  {% endif %}
  {% endblock %}