{% extends "_base_page.html" %}

{% block page_title %}{{ supplier.name }} â€“ Digital Marketplace{% endblock %}

{% block breadcrumb %}
  {% with
    items = [
      {
          "link": url_for('main.index'),
          "label": "Home"
      },
      {
          "link": url_for('main.supplier_search'),
          "label": "Seller catalogue"
      },
      {
          "label": "Seller details"
      }
    ] %}
    {% include "toolkit/breadcrumb.html" %}
  {% endwith %}
{% endblock %}

{% block body_classes %}content-details{% endblock %}
{% block main_content %}

  {% with messages = get_flashed_messages(with_categories=True) %}
    {% for category, message in messages %}
      <div class="callout--success" aria-labelledby="callout--success__heading" aria-role="group" tabindex="-1" role="alert">
        {% if category == 'casestudy_deleted' %}
          <p id="callout--success__heading">The case study <strong>{{message.casestudy_name}}</strong> has been deleted</p>
        {% endif %}
      </div>
    {% endfor %}
  {% endwith %}


  {% with
  heading = supplier.name,
  smaller = True %}
  <div class="cta-heading-wrap">
    {% if user_owns_page %}
      <span class="cta-link">
      <a href="/sellers/update">Edit profile</a>
    </span>
    {% endif %}
    {% include "toolkit/page-heading.html" %}
  </div>
  {% endwith %}

  {% if supplier.summary %}
    <p>
      {{ supplier.summary }}
    </p>
  {% endif %}

  <hr>

  <ul class="list-horizontal">
    <li>
      <p>Seller capabilities</p>
      <article>
        <footer class="tags">
          <dl class="visually-hidden">
            <dt>Capabilities</dt>
          </dl>
          {% for category in supplier["categories"]|sort() %}
            <dd>
              <a href="#" class="disabled">{{ category }}</a>
            </dd>
          {% endfor %}
        </footer>
      </article>
    </li>
    {% if 'CASE_STUDY' is active_feature %}
    <li>
      <p>Case Studies</p>
      <div class="casestudy-wrapper">
      <ul class="list-vertical--thirds">
        {% if supplier["caseStudies"]|count > 0 %}
          {% for casestudy in supplier["caseStudies"] %}
            <li>
            <article>
              <h3>
                <a href="{{ url_for('.get_supplier_case_study', casestudy_id=casestudy.id) }}">{{ casestudy.title }}</a>
              </h3>
              <p>
                <small>{{ casestudy.client }}</small>
              </p>
            </article>
            </li>
          {% endfor %}
        {% endif %}
      </ul>
      {% if user_owns_page %}
        <p><a href="{{ url_for('.new_supplier_case_study')}}">Add case study</a></p>
      {% endif %}
      </div>
    </li>
    {% endif %}
    <li>
      <p>Contact</p>
      <article>
        {% for contact in supplier.contacts %}
          <p>
            <strong>Name</strong><br>
            {{ contact.name }}
          </p>
          <p>
            <strong>Email</strong><br>
            <a href="mailto:{{ contact.email }}">{{ contact.email }}</a>
          </p>
          <p>
            <strong>Phone</strong><br>
            {{ contact.phone }}
          </p>
          {% if not loop.last %}
            <hr>
          {% endif %}
        {% endfor %}
      </article>
    </li>
    <li>
      <p>Company Details</p>
      <article>
        <p>
          <strong>ABN</strong><br>
          {{ supplier.abn }}
        </p>
        {% if supplier.website %}
          <p>
            <strong>Website</strong><br>
            <a href="{{ supplier.website }}" target="_blank">{{ supplier.website }}</a>
          </p>
        {% endif %}
        {% if supplier.linkedin %}
          <p>
            <strong>LinkedIn</strong><br>
            <a href="{{ supplier.linkedin }}" target="_blank">{{ supplier.linkedin }}</a>
          </p>
        {% endif %}
      </article>
    </li>
    <li>
      <p>Address</p>
      <article>
        <p>
          {{ supplier.address.addressLine }}<br>
          {{ supplier.address.suburb }}<br>
          {{ supplier.address.state }} {{ supplier.address.postalCode }}
        </p>
      </article>
    </li>
    {% if supplier.references %}
      <li>
        <p>References</p>
        {% for reference in supplier.references %}
          <article>
            To be added
          </article>
        {% endfor %}
      </li>
    {% endif %}
    <li class="hidden">
      <p>Endorsements</p>
      <article>
        To be added
      </article>
    </li>
    <li class="hidden">
      <p>Case studies</p>
      <article>
        To be added
      </article>
    </li>

    <li>
      <p>Rate card</p>
      {% if supplier.prices %}
        <article>
          <table class="content-table">
            <thead>
            <tr>
              <th scope="col">Roles</th>
              <th scope="col">Day rates</th>
            </tr>
            </thead>
            <tbody>
            {% for price in supplier.prices|sort(attribute='serviceRole.role') %}
              <tr>
                <th scope="row">{{ price.serviceRole.role }}</th>
                <td>${{ price.dailyRate }}</td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
        </article>
      {% endif %}
    </li>

  </ul>
{% endblock %}
